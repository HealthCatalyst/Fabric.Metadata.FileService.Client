queue: 'Hosted VS2017'

variables:
  buildConfiguration: 'Release'

steps:
- script: |
    dotnet build Fabric.Metadata.FileService.Client --configuration $(buildConfiguration)
    dotnet pack Fabric.Metadata.FileService.Client --configuration Release --output $(Build.ArtifactStagingDirectory)

- task: NuGetInstaller@0
  displayName: 'NuGet restore'
  inputs:
    solution: '**\Fabric.Metadata.FileService.Client.sln'
    noCache: true
    verbosity: Detailed

- task: VSBuild@1
  displayName: Build
  inputs:
    solution: Api.Metadata/v2/Catalyst.Metadata.v2/Api.Metadata.v2.sln
    vsVersion: 15.0
    platform: '$(BuildPlatform)'
    configuration: '$(BuildConfiguration)'
    clean: true    

#- task: NuGetCommand@2
#  inputs:
#    command: push
#    nuGetFeedType: external
#    publishFeedCredentials: 'Nuget.org Health Catalyst Account'
#    versioningScheme: byEnvVar
#    versionEnvVar: Version    

- task: PublishTestResults@2
  inputs:
    testRunner: VSTest
    testResultsFiles: '**/*.trx'